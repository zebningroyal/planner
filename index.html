<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crimson Planner</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&family=JetBrains+Mono:wght@500&display=swap" rel="stylesheet">
    <style>
        :root {
            --accent-red: #f43f5e;
            --accent-purple: #a855f7;
            --bg-dark: #020617; 
            --panel-bg: rgba(30, 41, 59, 0.7);
        }

        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background-color: var(--bg-dark);
            color: white;
            min-height: 100vh;
            background-image: 
                radial-gradient(circle at 50% 50%, rgba(168, 85, 247, 0.08), transparent 80%);
        }

        .neural-bg {
            position: fixed;
            inset: 0;
            z-index: -1;
            background-image: 
                linear-gradient(rgba(244, 63, 94, 0.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(168, 85, 247, 0.03) 1px, transparent 1px);
            background-size: 40px 40px;
        }

        .glass {
            background: var(--panel-bg);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 24px; 
            box-shadow: 0 4px 24px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
        }

        .glass:hover {
            border-color: rgba(244, 63, 94, 0.3);
        }

        .digital-clock { 
            font-family: 'JetBrains Mono', monospace; 
            color: var(--accent-red);
        }

        .task-item {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 12px;
            transition: all 0.2s ease;
        }
        .task-item:hover {
            background: rgba(168, 85, 247, 0.1);
        }

        .xp-container {
            height: 12px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 20px;
            overflow: hidden;
            border: 1px solid rgba(255,255,255,0.05);
        }
        .xp-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent-red), var(--accent-purple));
            transition: width 0.8s cubic-bezier(0.4, 0, 0.2, 1);
        }

        #pie-chart {
            width: 140px;
            height: 140px;
            border-radius: 50%;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }
        #pie-chart::after {
            content: '';
            position: absolute;
            inset: 25px;
            background: #020617;
            border-radius: 50%;
        }

        .mono-label {
            font-family: 'JetBrains Mono', monospace;
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            color: var(--accent-purple);
        }

        .day-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
        }

        .load-info-tag {
            font-size: 11px;
            font-weight: 800;
            text-transform: uppercase;
            padding: 5px 12px;
            border-radius: 8px;
            background: rgba(255,255,255,0.03);
            display: flex;
            justify-content: space-between;
            width: 100%;
            border: 1px solid rgba(255,255,255,0.05);
        }

        /* Menu Styles */
        #main-menu {
            transform: translateY(-10px);
            opacity: 0;
            pointer-events: none;
            transition: all 0.3s ease;
        }
        #main-menu.active {
            transform: translateY(0);
            opacity: 1;
            pointer-events: auto;
        }

        /* Modals */
        .modal-overlay {
            display: none;
            position: fixed;
            inset: 0;
            z-index: 300;
            align-items: center;
            justify-content: center;
            background: rgba(2, 6, 23, 0.85);
            backdrop-filter: blur(8px);
            padding: 24px;
        }
        .modal-overlay.active { display: flex; }

        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: rgba(244, 63, 94, 0.2); border-radius: 10px; }

        .auth-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            background: white;
            color: black;
            padding: 12px 24px;
            border-radius: 12px;
            font-weight: 700;
            font-size: 14px;
            transition: all 0.2s;
        }
        .auth-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(255,255,255,0.1);
        }
    </style>
</head>
<body class="p-4 md:p-8">
    <div class="neural-bg"></div>

    <div class="max-w-7xl mx-auto">
        <!-- Header with Integrated Menu -->
        <header class="relative flex flex-col md:flex-row justify-between items-center gap-6 mb-12 z-[110]">
            <div class="flex items-center gap-4">
                <div id="user-avatar" class="hidden w-12 h-12 rounded-full border-2 border-rose-500 overflow-hidden bg-slate-800">
                    <img id="user-photo" src="" alt="User" class="w-full h-full object-cover">
                </div>
                <div>
                    <h1 class="text-4xl font-extrabold text-white tracking-tight"><span id="header-name">Md Shazeb</span>'s <span class="text-rose-500">Planner</span></h1>
                    <div class="flex items-center gap-3 mt-1">
                        <span id="clock" class="digital-clock font-bold text-lg">00:00:00</span>
                        <span id="header-status" class="text-slate-500 text-xs uppercase tracking-widest px-2 py-0.5 bg-slate-800/50 rounded-md">Local Mode</span>
                    </div>
                </div>
            </div>
            
            <div class="flex items-center gap-3">
                <div class="relative">
                    <button onclick="toggleMenu()" class="flex items-center gap-2 px-6 py-2.5 rounded-xl text-xs font-bold border border-slate-700 hover:bg-slate-800 transition-all uppercase tracking-widest">
                        <span id="menu-label">Access Control</span>
                        <svg id="menu-icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="transition-transform"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg>
                    </button>
                    
                    <!-- Dropdown Menu Content -->
                    <div id="main-menu" class="absolute right-0 mt-3 w-64 glass p-4 z-[120] border-rose-500/20 shadow-2xl">
                        <div class="space-y-1">
                            <div id="auth-section">
                                <button onclick="handleAuth()" id="auth-main-btn" class="w-full text-left px-4 py-3 rounded-xl text-[10px] font-bold uppercase tracking-widest bg-rose-500 hover:bg-rose-600 transition-colors flex items-center gap-3">
                                    <span class="w-1.5 h-1.5 rounded-full bg-white"></span> Sign In (Cross-Device)
                                </button>
                            </div>
                            <div class="h-px bg-white/5 my-2"></div>
                            <button onclick="openProfile(); toggleMenu()" class="w-full text-left px-4 py-3 rounded-xl text-[10px] font-bold uppercase tracking-widest hover:bg-white/5 transition-colors flex items-center gap-3">
                                <span class="w-1.5 h-1.5 rounded-full bg-rose-500"></span> Identity Profile
                            </button>
                            <button onclick="toggleLogs(); toggleMenu()" class="w-full text-left px-4 py-3 rounded-xl text-[10px] font-bold uppercase tracking-widest hover:bg-white/5 transition-colors flex items-center gap-3">
                                <span class="w-1.5 h-1.5 rounded-full bg-slate-500"></span> Status Logs
                            </button>
                            <div class="h-px bg-white/5 my-2"></div>
                            <button onclick="exportData(); toggleMenu()" class="w-full text-left px-4 py-3 rounded-xl text-[10px] font-bold uppercase tracking-widest hover:bg-white/5 transition-colors flex items-center gap-3">
                                <span class="w-1.5 h-1.5 rounded-full bg-blue-500"></span> Backup To File
                            </button>
                            <button onclick="flushWeek(); toggleMenu()" class="w-full text-left px-4 py-3 rounded-xl text-[10px] font-bold uppercase tracking-widest text-rose-400 hover:bg-rose-500 hover:text-white transition-all flex items-center gap-3">
                                <span class="w-1.5 h-1.5 rounded-full bg-current"></span> Purge Data
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <!-- Main Content Area -->
        <div class="grid grid-cols-1 lg:grid-cols-12 gap-8 mb-12">
            <div class="lg:col-span-6 space-y-6">
                <div class="glass p-8">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="mono-label">Quick Insertion</h2>
                        <span class="text-[9px] text-slate-500 uppercase font-black">Ready for input</span>
                    </div>
                    
                    <form id="quick-add-form" onsubmit="event.preventDefault(); processQuickAdd();" class="relative flex gap-2">
                        <input id="quick-add-input" class="flex-1 bg-slate-900/50 border border-slate-700 rounded-xl px-5 py-4 text-sm focus:outline-none focus:border-rose-500/50 transition-colors" placeholder="e.g. 'Homework at 5pm Friday'">
                        <button type="submit" class="bg-rose-500 hover:bg-rose-600 text-white px-6 py-4 rounded-xl text-xs font-bold uppercase tracking-widest transition-all transform active:scale-95">Add</button>
                    </form>
                </div>

                <div class="glass p-8">
                    <div class="flex justify-between items-end mb-4">
                        <div>
                            <h2 class="mono-label">Sync Progress</h2>
                            <p id="xp-text" class="text-xs text-slate-500 mt-1 font-bold">0 / 0 Sub-routines complete</p>
                        </div>
                        <span id="xp-percentage" class="text-5xl font-black text-rose-500">0%</span>
                    </div>
                    <div class="xp-container">
                        <div id="xp-bar-fill" class="xp-fill" style="width: 0%"></div>
                    </div>
                </div>
            </div>

            <div class="lg:col-span-6 glass p-8">
                <div class="flex flex-col md:flex-row items-center gap-8 h-full">
                    <div class="flex flex-col items-center">
                        <div id="pie-chart">
                            <div class="relative z-10 text-center">
                                <div id="total-tasks-count" class="text-4xl font-black">0</div>
                                <div class="text-[9px] font-bold text-slate-500 uppercase tracking-widest">Load</div>
                                <div id="load-status" class="text-[8px] font-bold text-rose-400 mt-1 uppercase tracking-tighter">Standby</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="flex-1 w-full space-y-3">
                        <div class="border-b border-white/5 pb-2 mb-2 flex justify-between items-center">
                            <span class="text-[10px] font-black text-slate-400 uppercase tracking-widest">Day Distribution</span>
                            <span class="text-[9px] font-bold text-slate-600 uppercase tracking-widest">Tasks</span>
                        </div>
                        <div id="day-breakdown-list" class="grid grid-cols-1 sm:grid-cols-2 gap-2"></div>
                    </div>
                </div>
            </div>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 xl:grid-cols-7 gap-6" id="planner-grid"></div>
    </div>

    <!-- Profile Settings Modal -->
    <div id="profile-modal" class="modal-overlay">
        <div class="glass max-w-md w-full p-8 space-y-6">
            <div class="flex justify-between items-center">
                <h2 class="text-xl font-bold tracking-tight">Identity Profile</h2>
                <button onclick="closeProfile()" class="text-slate-500 hover:text-white transition-colors">âœ•</button>
            </div>
            
            <div class="space-y-4">
                <div class="space-y-2">
                    <label class="mono-label block">Display Name</label>
                    <input id="profile-name-input" type="text" class="w-full bg-slate-900/50 border border-slate-700 rounded-xl px-4 py-3 text-sm focus:outline-none focus:border-rose-500" placeholder="e.g. Md Shazeb">
                </div>
                <div class="space-y-2">
                    <label class="mono-label block">Custom Status</label>
                    <input id="profile-status-input" type="text" class="w-full bg-slate-900/50 border border-slate-700 rounded-xl px-4 py-3 text-sm focus:outline-none focus:border-rose-500" placeholder="e.g. Studying">
                </div>
            </div>

            <button onclick="saveProfile()" class="w-full bg-rose-500 hover:bg-rose-600 text-white font-bold py-4 rounded-xl text-xs uppercase tracking-widest transition-all">Update Identity</button>
        </div>
    </div>

    <!-- Auth Modal -->
    <div id="auth-modal" class="modal-overlay">
        <div class="glass max-w-sm w-full p-8 text-center space-y-6">
            <h2 class="text-2xl font-black">Access Hub</h2>
            <p class="text-sm text-slate-400 leading-relaxed">Sign in with Google to sync your planner across your phone, tablet, and computer instantly.</p>
            
            <button onclick="signInGoogle()" class="auth-btn w-full">
                <svg width="18" height="18" viewBox="0 0 18 18"><path d="M17.64 9.2c0-.63-.06-1.25-.16-1.84H9v3.49h4.84a4.14 4.14 0 0 1-1.8 2.71v2.26h2.91c1.7-1.56 2.69-3.86 2.69-6.62z" fill="#4285F4"/><path d="M9 18c2.43 0 4.47-.8 5.96-2.18l-2.91-2.26c-.8.54-1.83.86-3.05.86-2.34 0-4.33-1.58-5.04-3.7H.95v2.34A8.997 8.997 0 0 0 9 18z" fill="#34A853"/><path d="M3.96 10.72A5.41 5.41 0 0 1 3.68 9c0-.59.1-1.17.28-1.72V4.94H.95A8.99 8.99 0 0 0 0 9c0 1.45.35 2.82.95 4.06l3.01-2.34z" fill="#FBBC05"/><path d="M9 3.58c1.32 0 2.5.45 3.44 1.35l2.58-2.58C13.47.89 11.43 0 9 0 5.48 0 2.44 2.02.95 4.94l3.01 2.34C4.67 5.16 6.66 3.58 9 3.58z" fill="#EA4335"/></svg>
                Continue with Google
            </button>

            <button onclick="closeAuth()" class="text-[10px] text-slate-500 hover:text-slate-300 uppercase tracking-widest font-bold">Keep it local</button>
        </div>
    </div>

    <div id="status-toast" class="fixed bottom-8 right-8 glass px-6 py-4 translate-y-20 opacity-0 transition-all duration-500 z-[200]">
        <span id="status-message" class="text-xs font-bold uppercase tracking-widest"></span>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInWithPopup, GoogleAuthProvider, onAuthStateChanged, signOut, signInAnonymously, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, setDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Environment Globals
        const firebaseConfig = JSON.parse(__firebase_config);
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'crimson-planner-v1';
        
        // Init Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const provider = new GoogleAuthProvider();

        // App State
        const days = ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"];
        const dayColors = {
            "Sunday": "#f43f5e", "Monday": "#fb7185", "Tuesday": "#e879f9", 
            "Wednesday": "#c084fc", "Thursday": "#a855f7", "Friday": "#9333ea", "Saturday": "#7e22ce"
        };

        let plannerData = JSON.parse(localStorage.getItem('prod_suite_v6')) || days.reduce((a, d) => ({...a, [d]: []}), {});
        let profileData = JSON.parse(localStorage.getItem('prod_profile_v6')) || { name: "User", status: "Local Mode" };
        let currentUser = null;

        // AUTH LOGIC
        const initAuth = async () => {
            if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                await signInWithCustomToken(auth, __initial_auth_token);
            } else {
                // We don't force login, we let users choose. Default is local.
            }
        };
        initAuth();

        onAuthStateChanged(auth, (user) => {
            currentUser = user;
            if (user) {
                document.getElementById('user-avatar').classList.remove('hidden');
                document.getElementById('user-photo').src = user.photoURL || '';
                document.getElementById('auth-main-btn').innerHTML = `<span class="w-1.5 h-1.5 rounded-full bg-green-500"></span> Sign Out`;
                document.getElementById('header-status').innerText = "Cloud Synced";
                
                // Load profile from user data if not set
                if (profileData.name === "User") {
                    profileData.name = user.displayName || "User";
                }
                updateHeader();

                // Setup Firestore Listener
                const userDoc = doc(db, 'artifacts', appId, 'users', user.uid, 'settings', 'data');
                onSnapshot(userDoc, (docSnap) => {
                    if (docSnap.exists()) {
                        const cloudData = docSnap.data();
                        plannerData = cloudData.planner || plannerData;
                        profileData = cloudData.profile || profileData;
                        updateHeader();
                        render();
                    }
                }, (err) => console.error("Firestore Error:", err));
            } else {
                document.getElementById('user-avatar').classList.add('hidden');
                document.getElementById('auth-main-btn').innerHTML = `<span class="w-1.5 h-1.5 rounded-full bg-rose-500"></span> Sign In (Cross-Device)`;
                document.getElementById('header-status').innerText = "Local Mode";
            }
        });

        window.signInGoogle = async () => {
            try {
                const result = await signInWithPopup(auth, provider);
                closeAuth();
                showStatus(`Welcome, ${result.user.displayName}`);
                await saveToCloud();
            } catch (error) {
                showStatus("Auth Failed");
            }
        };

        window.handleAuth = () => {
            if (currentUser) {
                if(confirm("Sign out of Cloud Sync?")) {
                    signOut(auth);
                    showStatus("Disconnected");
                }
            } else {
                document.getElementById('auth-modal').classList.add('active');
            }
        };

        const saveToCloud = async () => {
            if (!currentUser) return;
            const userDoc = doc(db, 'artifacts', appId, 'users', currentUser.uid, 'settings', 'data');
            await setDoc(userDoc, {
                planner: plannerData,
                profile: profileData,
                lastUpdated: Date.now()
            }, { merge: true });
        };

        // UI HELPERS
        window.toggleMenu = () => {
            const menu = document.getElementById('main-menu');
            const icon = document.getElementById('menu-icon');
            const isActive = menu.classList.toggle('active');
            icon.style.transform = isActive ? 'rotate(90deg)' : 'rotate(0)';
        };

        window.openProfile = () => {
            document.getElementById('profile-name-input').value = profileData.name;
            document.getElementById('profile-status-input').value = profileData.status;
            document.getElementById('profile-modal').classList.add('active');
        };

        window.closeProfile = () => document.getElementById('profile-modal').classList.remove('active');
        window.closeAuth = () => document.getElementById('auth-modal').classList.remove('active');

        window.saveProfile = async () => {
            const name = document.getElementById('profile-name-input').value.trim() || "User";
            const status = document.getElementById('profile-status-input').value.trim() || "Active";
            profileData = { name, status };
            localStorage.setItem('prod_profile_v6', JSON.stringify(profileData));
            updateHeader();
            closeProfile();
            showStatus("Identity Updated");
            await saveToCloud();
        };

        function updateHeader() {
            document.getElementById('header-name').innerText = profileData.name;
            if (!currentUser) document.getElementById('header-status').innerText = profileData.status;
            document.title = `${profileData.name}'s Planner`;
        }

        window.processQuickAdd = async () => {
            const input = document.getElementById('quick-add-input');
            const val = input.value.trim();
            if (!val) return;

            const timeMatch = val.match(/(\d{1,2}(:\d{2})?\s*(am|pm))/i);
            const timeLabel = timeMatch ? timeMatch[0].toUpperCase() : "Anytime";
            
            let dayMatch = days.find(d => val.toLowerCase().includes(d.toLowerCase()));
            if (!dayMatch) dayMatch = days[new Date().getDay()];

            let taskText = val
                .replace(timeLabel, '')
                .replace(new RegExp(dayMatch, 'gi'), '')
                .replace(/\bat\b/gi, '')
                .trim() || "New Task";

            plannerData[dayMatch].push({
                text: taskText,
                done: false,
                timeLabel: timeLabel,
                id: Date.now()
            });

            input.value = "";
            showStatus(`Logged to ${dayMatch}`);
            render();
            await saveToCloud();
        };

        window.toggleTask = async (day, id) => {
            const task = plannerData[day].find(t => t.id === id);
            if (task) {
                task.done = !task.done;
                showStatus(task.done ? "Synced" : "Re-opened");
            }
            render();
            await saveToCloud();
        };

        window.deleteTask = async (day, id) => {
            plannerData[day] = plannerData[day].filter(t => t.id !== id);
            showStatus("Protocol Purged");
            render();
            await saveToCloud();
        };

        window.flushWeek = async () => {
            if(confirm("DANGER: Wiping all system protocols. Proceed?")) {
                plannerData = days.reduce((a, d) => ({...a, [d]: []}), {});
                showStatus("System Reset Complete");
                render();
                await saveToCloud();
            }
        };

        window.addManualTask = async (day) => {
            const t = prompt(`New task for ${day}:`);
            if(!t) return;
            const time = prompt(`Time:`) || "Anytime";
            plannerData[day].push({ text: t, done: false, timeLabel: time.toUpperCase(), id: Date.now() });
            render();
            await saveToCloud();
        };

        // RENDER LOGIC
        function showStatus(msg) {
            const toast = document.getElementById('status-toast');
            document.getElementById('status-message').innerText = msg;
            toast.classList.remove('translate-y-20', 'opacity-0');
            setTimeout(() => toast.classList.add('translate-y-20', 'opacity-0'), 2000);
        }

        function updateClock() {
            const now = new Date();
            document.getElementById('clock').innerText = now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit', second: '2-digit' });
        }

        function updateProgress() {
            let total = 0, done = 0;
            const distribution = {};
            days.forEach(day => {
                const tasks = plannerData[day] || [];
                distribution[day] = tasks.length;
                total += tasks.length;
                done += tasks.filter(t => t.done).length;
            });

            const rate = total > 0 ? Math.round((done / total) * 100) : 0;
            document.getElementById('xp-bar-fill').style.width = `${rate}%`;
            document.getElementById('xp-percentage').innerText = `${rate}%`;
            document.getElementById('xp-text').innerText = `${done} / ${total} Sub-routines complete`;
            document.getElementById('total-tasks-count').innerText = total;

            const breakdownList = document.getElementById('day-breakdown-list');
            breakdownList.innerHTML = '';
            days.forEach(day => {
                const count = distribution[day];
                const div = document.createElement('div');
                div.className = 'flex items-center gap-3';
                div.innerHTML = `<div class="w-2 h-2 rounded-full" style="background:${dayColors[day]}"></div>
                                <div class="load-info-tag" style="color:${dayColors[day]}"><span>${day}</span><span class="opacity-80">${count}</span></div>`;
                breakdownList.appendChild(div);
            });

            const slices = []; let curr = 0;
            days.forEach(day => {
                const count = distribution[day];
                if (count > 0) {
                    const p = (count/total)*100;
                    slices.push(`${dayColors[day]} ${curr}% ${curr+p}%`);
                    curr += p;
                }
            });
            document.getElementById('pie-chart').style.background = total === 0 ? '#1e293b' : `conic-gradient(${slices.join(', ')})`;
        }

        function render() {
            localStorage.setItem('prod_suite_v6', JSON.stringify(plannerData));
            updateProgress();
            const grid = document.getElementById('planner-grid');
            grid.innerHTML = '';

            days.forEach(day => {
                const tasks = plannerData[day] || [];
                const col = document.createElement('div');
                col.className = 'glass p-6 flex flex-col min-h-[350px]';
                col.innerHTML = `
                    <div class="flex justify-between items-center mb-6 border-b border-white/5 pb-3">
                        <div class="flex items-center gap-2">
                            <div class="day-dot" style="background:${dayColors[day]}"></div>
                            <h3 class="font-bold text-sm tracking-tight">${day.toUpperCase()}</h3>
                        </div>
                        <button onclick="addManualTask('${day}')" class="w-7 h-7 flex items-center justify-center rounded-lg bg-white/5 hover:bg-rose-500 hover:text-white transition-all text-xl leading-none">+</button>
                    </div>
                    <div class="space-y-3 flex-1 overflow-y-auto max-h-[400px]">
                        ${tasks.length === 0 ? '<p class="text-[10px] text-slate-700 text-center mt-12 uppercase tracking-[0.2em] opacity-40 italic">Standby...</p>' : ''}
                        ${tasks.map(t => `
                            <div class="task-item p-3 cursor-pointer group ${t.done ? 'opacity-40 grayscale' : ''}" onclick="toggleTask('${day}', ${t.id})">
                                <div class="flex justify-between items-start">
                                    <span class="text-[9px] font-bold text-rose-400 mb-1 tracking-widest">${t.timeLabel}</span>
                                    <button onclick="event.stopPropagation(); deleteTask('${day}', ${t.id})" class="text-[8px] text-slate-600 hover:text-rose-500 uppercase font-black opacity-0 group-hover:opacity-100 transition-opacity">Clear</button>
                                </div>
                                <p class="text-xs font-semibold text-slate-100 leading-relaxed">${t.text}</p>
                            </div>
                        `).join('')}
                    </div>
                `;
                grid.appendChild(col);
            });
        }

        // Global Event Listeners
        window.addEventListener('click', (e) => {
            if (e.target.classList.contains('modal-overlay')) {
                closeProfile();
                closeAuth();
            }
        });

        setInterval(updateClock, 1000);
        updateHeader();
        render();
    </script>
</body>
</html>
